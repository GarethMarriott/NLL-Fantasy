{% extends "web/base.html" %}
{% block title %}Matchups — NLL Fantasy{% endblock %}
{% block content %}
  <div class="container p-2 mx-auto rounded-md sm:p-4 dark:text-gray-800 dark:bg-gray-50">
    <div class="flex items-center justify-between mb-3">
      <h2 class="text-2xl font-semibold leading-tight">Matchups</h2>
      <a href="{% url 'schedule' %}" class="text-blue-600 hover:text-blue-800 hover:underline text-sm font-medium">
        View Full Schedule →
      </a>
    </div>
    <p class="mb-4 text-sm text-gray-600">View weekly head-to-head matchups and team rosters</p>

    {% if schedule_weeks %}
      <form method="get" class="inline-form mb-4">
        <label for="week" class="text-sm font-medium mr-2">Week:</label>
        <select name="week" id="week" onchange="this.form.submit()" class="px-3 py-1.5 border border-gray-300 rounded-md">
          {% for wk in schedule_weeks %}
            <option value="{{ wk.week_number }}" {% if selected_week_number == wk.week_number %}selected{% endif %}>Week {{ wk.week_number }}</option>
          {% endfor %}
        </select>
        <noscript><button type="submit" class="ml-2 px-3 py-1.5 bg-blue-500 text-white rounded-md">Go</button></noscript>
      </form>

      {% if selected_week %}
        <section class="schedule-week">
          <h3 class="text-xl font-semibold mb-4">Week {{ selected_week.week_number }}</h3>
          
          {% for game in selected_week.games %}
            <div class="mb-6 border border-gray-300 rounded-lg bg-white shadow-sm overflow-hidden">
              {# Matchup Header - Always Visible #}
              <div class="p-4 cursor-pointer hover:bg-gray-50 transition-colors" onclick="toggleMatchup('matchup-{{ forloop.counter }}')">
                <div class="grid grid-cols-2 gap-6">
                  {# Home Team Summary #}
                  <div class="flex justify-between items-center">
                    <h4 class="text-lg font-bold">
                      <a href="{% url 'team_detail' game.home.id %}" class="text-blue-600 hover:text-blue-800 hover:underline" onclick="event.stopPropagation()">
                        {{ game.home.name }}
                      </a>
                    </h4>
                    <span class="text-xl font-bold {% if game.home_result == 'W' %}text-green-600{% elif game.home_result == 'L' %}text-red-600{% endif %}">
                      {{ game.home_total }}
                    </span>
                  </div>
                  
                  {# Away Team Summary #}
                  <div class="flex justify-between items-center">
                    <h4 class="text-lg font-bold">
                      <a href="{% url 'team_detail' game.away.id %}" class="text-blue-600 hover:text-blue-800 hover:underline" onclick="event.stopPropagation()">
                        {{ game.away.name }}
                      </a>
                    </h4>
                    <span class="text-xl font-bold {% if game.away_result == 'W' %}text-green-600{% elif game.away_result == 'L' %}text-red-600{% endif %}">
                      {{ game.away_total }}
                    </span>
                  </div>
                </div>
                
                {# Expand/Collapse Indicator #}
                <div class="text-center mt-2 text-gray-500 text-sm">
                  <span id="matchup-{{ forloop.counter }}-indicator">▼ Click to view rosters</span>
                </div>
              </div>
              
              {# Matchup Details - Initially Hidden #}
              <div id="matchup-{{ forloop.counter }}" class="hidden border-t border-gray-300">
                <div class="grid grid-cols-2 gap-6 p-4">
                  {# Home Team Details #}
                  <div>
                    {# Offense Section #}
                    <div class="mb-3">
                      <h5 class="font-semibold mb-2 text-green-700 text-sm">Offence</h5>
                      <div class="space-y-1">
                        {% for slot in game.home_roster.offence_slots %}
                          {% if slot %}
                            <div class="flex justify-between text-xs {% if slot.counts_for_total %}bg-green-100 px-2 py-1 rounded font-semibold{% endif %}">
                              <span>{{ slot.player.last_name }}, {{ slot.player.first_name }} #{{ slot.player.number }}</span>
                              <span class="font-semibold">{% if slot.fantasy_points is not None %}{{ slot.fantasy_points }}{% else %}-{% endif %}</span>
                            </div>
                          {% else %}
                            <div class="text-xs text-gray-400">Empty slot</div>
                          {% endif %}
                        {% endfor %}
                      </div>
                    </div>
                    
                    {# Defence Section #}
                    <div class="mb-3">
                      <h5 class="font-semibold mb-2 text-orange-700 text-sm">Defence</h5>
                      <div class="space-y-1">
                        {% for slot in game.home_roster.defence_slots %}
                          {% if slot %}
                            <div class="flex justify-between text-xs {% if slot.counts_for_total %}bg-orange-100 px-2 py-1 rounded font-semibold{% endif %}">
                              <span>{{ slot.player.last_name }}, {{ slot.player.first_name }} #{{ slot.player.number }}</span>
                              <span class="font-semibold">{% if slot.fantasy_points is not None %}{{ slot.fantasy_points }}{% else %}-{% endif %}</span>
                            </div>
                          {% else %}
                            <div class="text-xs text-gray-400">Empty slot</div>
                          {% endif %}
                        {% endfor %}
                      </div>
                    </div>
                    
                    {# Goalie Section #}
                    <div class="mb-3">
                      <h5 class="font-semibold mb-2 text-purple-700 text-sm">Goalie</h5>
                      <div class="space-y-1">
                        {% for slot in game.home_roster.goalie_slots %}
                          {% if slot %}
                            <div class="flex justify-between text-xs {% if slot.counts_for_total %}bg-purple-100 px-2 py-1 rounded font-semibold{% endif %}">
                              <span>{{ slot.player.last_name }}, {{ slot.player.first_name }} #{{ slot.player.number }}</span>
                              <span class="font-semibold">{% if slot.fantasy_points is not None %}{{ slot.fantasy_points }}{% else %}-{% endif %}</span>
                            </div>
                          {% else %}
                            <div class="text-xs text-gray-400">Empty slot</div>
                          {% endif %}
                        {% endfor %}
                      </div>
                    </div>
                    
                    <div class="border-t border-gray-300 pt-2 mt-2">
                      <div class="flex justify-between text-sm font-bold">
                        <span>Total:</span>
                        <span class="{% if game.home_result == 'W' %}text-green-600{% elif game.home_result == 'L' %}text-red-600{% endif %}">{{ game.home_total }} — {{ game.home_result }}</span>
                      </div>
                    </div>
                  </div>
                  
                  {# Away Team Details #}
                  <div>
                    {# Offense Section #}
                    <div class="mb-3">
                      <h5 class="font-semibold mb-2 text-green-700 text-sm">Offence</h5>
                      <div class="space-y-1">
                        {% for slot in game.away_roster.offence_slots %}
                          {% if slot %}
                            <div class="flex justify-between text-xs {% if slot.counts_for_total %}bg-green-100 px-2 py-1 rounded font-semibold{% endif %}">
                              <span>{{ slot.player.last_name }}, {{ slot.player.first_name }} #{{ slot.player.number }}</span>
                              <span class="font-semibold">{% if slot.fantasy_points is not None %}{{ slot.fantasy_points }}{% else %}-{% endif %}</span>
                            </div>
                          {% else %}
                            <div class="text-xs text-gray-400">Empty slot</div>
                          {% endif %}
                        {% endfor %}
                      </div>
                    </div>
                    
                    {# Defence Section #}
                    <div class="mb-3">
                      <h5 class="font-semibold mb-2 text-orange-700 text-sm">Defence</h5>
                      <div class="space-y-1">
                        {% for slot in game.away_roster.defence_slots %}
                          {% if slot %}
                            <div class="flex justify-between text-xs {% if slot.counts_for_total %}bg-orange-100 px-2 py-1 rounded font-semibold{% endif %}">
                              <span>{{ slot.player.last_name }}, {{ slot.player.first_name }} #{{ slot.player.number }}</span>
                              <span class="font-semibold">{% if slot.fantasy_points is not None %}{{ slot.fantasy_points }}{% else %}-{% endif %}</span>
                            </div>
                          {% else %}
                            <div class="text-xs text-gray-400">Empty slot</div>
                          {% endif %}
                        {% endfor %}
                      </div>
                    </div>
                    
                    {# Goalie Section #}
                    <div class="mb-3">
                      <h5 class="font-semibold mb-2 text-purple-700 text-sm">Goalie</h5>
                      <div class="space-y-1">
                        {% for slot in game.away_roster.goalie_slots %}
                          {% if slot %}
                            <div class="flex justify-between text-xs {% if slot.counts_for_total %}bg-purple-100 px-2 py-1 rounded font-semibold{% endif %}">
                              <span>{{ slot.player.last_name }}, {{ slot.player.first_name }} #{{ slot.player.number }}</span>
                              <span class="font-semibold">{% if slot.fantasy_points is not None %}{{ slot.fantasy_points }}{% else %}-{% endif %}</span>
                            </div>
                          {% else %}
                            <div class="text-xs text-gray-400">Empty slot</div>
                          {% endif %}
                        {% endfor %}
                      </div>
                    </div>
                    
                    <div class="border-t border-gray-300 pt-2 mt-2">
                      <div class="flex justify-between text-sm font-bold">
                        <span>Total:</span>
                        <span class="{% if game.away_result == 'W' %}text-green-600{% elif game.away_result == 'L' %}text-red-600{% endif %}">{{ game.away_total }} — {{ game.away_result }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </section>
        
        <script>
          function toggleMatchup(id) {
            const details = document.getElementById(id);
            const indicator = document.getElementById(id + '-indicator');
            
            if (details.classList.contains('hidden')) {
              details.classList.remove('hidden');
              indicator.textContent = '▲ Click to hide rosters';
            } else {
              details.classList.add('hidden');
              indicator.textContent = '▼ Click to view rosters';
            }
          }
        </script>
      {% else %}
        <p class="text-gray-600 italic">No matchups found for the selected week.</p>
      {% endif %}
    {% else %}
      <p class="text-gray-600 italic">No teams available to generate matchups.</p>
    {% endif %}
  </div>
{% endblock %}
