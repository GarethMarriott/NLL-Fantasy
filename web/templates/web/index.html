{% extends "web/base.html" %}
{% load custom_filters %}
{% block title %}{% if team %}Your Team{% else %}Home{% endif %} — NLL Fantasy{% endblock %}
{% block content %}
  {% if team %}
    <div class="container p-2 mx-auto rounded-md sm:p-4 dark:text-gray-800 dark:bg-gray-50">
      <div class="flex items-center justify-between mb-4">
        <h1 class="text-2xl font-semibold leading-tight">{{ team.name }}</h1>
        <p class="text-sm text-gray-600">{{ team.league.name }}</p>
      </div>

      <!-- Week Selector -->
      <div class="mb-4">
        <label for="week-selector" class="block text-sm font-medium text-gray-700 mb-2">Select Week:</label>
        <select id="week-selector" onchange="window.location.href='?week=' + this.value" class="block w-full sm:w-64 px-3 py-2 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
          {% for week in available_weeks %}
            {% if week.is_future %}
              <option value="{{ week.week_number }}" {% if week.week_number == current_week %}selected{% endif %}>
                Week {{ week.week_number }} (Future)
              </option>
            {% else %}
              <option value="{{ week.week_number }}" {% if week.week_number == current_week %}selected{% endif %}>
                Week {{ week.week_number }} ({{ week.start_date|date:"M d" }})
              </option>
            {% endif %}
          {% endfor %}
        </select>
      </div>

      <h2 class="text-xl font-semibold mb-3">Week {{ current_week }} Roster{% if is_future_week %} <span class="text-sm text-gray-500">(Projected)</span>{% endif %}</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full text-xs border-collapse border border-gray-300">
          <thead class="dark:bg-gray-300">
            <tr class="text-center">
              <th class="border border-gray-300 px-2 py-2 text-left">Slot</th>
              <th class="border border-gray-300 px-2 py-2 text-left">Position</th>
              <th class="border border-gray-300 px-2 py-2">#</th>
              <th class="border border-gray-300 px-2 py-2 text-left">Player</th>
              <th class="border border-gray-300 px-2 py-2">W{{ current_week }}</th>
            </tr>
          </thead>
          <tbody>
            {# Offence slots (1-6) #}
            {% for slot in offence_slots %}
              <tr class="border-b border-opacity-20 dark:border-gray-300 dark:bg-gray-100">
                <td class="border border-gray-300 px-2 py-2">{{ forloop.counter }}</td>
                <td class="border border-gray-300 px-2 py-2">
                  <span class="inline-block px-2 py-1 bg-green-100 text-green-800 rounded-md font-semibold border border-green-300 text-xs">Offence</span>
                </td>
                {% if slot %}
                  <td class="border border-gray-300 px-2 py-2 text-center">{{ slot.player.number|default:"—" }}</td>
                  <td class="border border-gray-300 px-2 py-2">
                    <div class="font-semibold">{{ slot.player.last_name }}, {{ slot.player.first_name }}</div>
                    {% if slot.player.nll_team %}<div class="text-xs text-gray-600">{{ slot.player.nll_team }}</div>{% endif %}
                  </td>
                  <td class="border border-gray-300 px-2 py-2 text-center">{% if slot.week_points is not None %}{% if slot.counts_for_total %}<strong class="text-green-600">{{ slot.week_points }}</strong>{% else %}{{ slot.week_points }}{% endif %}{% else %}-{% endif %}</td>
                {% else %}
                  <td class="border border-gray-300 px-2 py-2 text-center">—</td>
                  <td class="border border-gray-300 px-2 py-2 text-gray-400 italic">Empty slot</td>
                  <td class="border border-gray-300 px-2 py-2 text-center">—</td>
                {% endif %}
              </tr>
            {% endfor %}

            {# Defence slots (7-12) #}
            {% for slot in defence_slots %}
              <tr class="border-b border-opacity-20 dark:border-gray-300 dark:bg-gray-100">
                <td class="border border-gray-300 px-2 py-2">{{ forloop.counter|add:6 }}</td>
                <td class="border border-gray-300 px-2 py-2">
                  <span class="inline-block px-2 py-1 bg-orange-100 text-orange-800 rounded-md font-semibold border border-orange-300 text-xs">Defence</span>
                </td>
                {% if slot %}
                  <td class="border border-gray-300 px-2 py-2 text-center">{{ slot.player.number|default:"—" }}</td>
                  <td class="border border-gray-300 px-2 py-2">
                    <div class="font-semibold">{{ slot.player.last_name }}, {{ slot.player.first_name }}</div>
                    {% if slot.player.nll_team %}<div class="text-xs text-gray-600">{{ slot.player.nll_team }}</div>{% endif %}
                  </td>
                  <td class="border border-gray-300 px-2 py-2 text-center">{% if slot.week_points is not None %}{% if slot.counts_for_total %}<strong class="text-green-600">{{ slot.week_points }}</strong>{% else %}{{ slot.week_points }}{% endif %}{% else %}-{% endif %}</td>
                {% else %}
                  <td class="border border-gray-300 px-2 py-2 text-center">—</td>
                  <td class="border border-gray-300 px-2 py-2 text-gray-400 italic">Empty slot</td>
                  <td class="border border-gray-300 px-2 py-2 text-center">—</td>
                {% endif %}
              </tr>
            {% endfor %}

            {# Goalie slots (13-14) #}
            {% for slot in goalie_slots %}
              <tr class="border-b border-opacity-20 dark:border-gray-300 dark:bg-gray-100">
                <td class="border border-gray-300 px-2 py-2">{{ forloop.counter|add:12 }}</td>
                <td class="border border-gray-300 px-2 py-2">
                  <span class="inline-block px-2 py-1 bg-blue-100 text-blue-800 rounded-md font-semibold border border-blue-300 text-xs">Goalie</span>
                </td>
                {% if slot %}
                  <td class="border border-gray-300 px-2 py-2 text-center">{{ slot.player.number|default:"—" }}</td>
                  <td class="border border-gray-300 px-2 py-2">
                    <div class="font-semibold">{{ slot.player.last_name }}, {{ slot.player.first_name }}</div>
                    {% if slot.player.nll_team %}<div class="text-xs text-gray-600">{{ slot.player.nll_team }}</div>{% endif %}
                  </td>
                  <td class="border border-gray-300 px-2 py-2 text-center">{% if slot.week_points is not None %}{% if slot.counts_for_total %}<strong class="text-green-600">{{ slot.week_points }}</strong>{% else %}{{ slot.week_points }}{% endif %}{% else %}-{% endif %}</td>
                {% else %}
                  <td class="border border-gray-300 px-2 py-2 text-center">—</td>
                  <td class="border border-gray-300 px-2 py-2 text-gray-400 italic">Empty slot</td>
                  <td class="border border-gray-300 px-2 py-2 text-center">—</td>
                {% endif %}
              </tr>
            {% endfor %}
            
            {# Weekly total row #}
            <tr class="border-t-2 border-gray-400 dark:bg-gray-200">
              <td class="border border-gray-300 px-2 py-2">—</td>
              <td class="border border-gray-300 px-2 py-2">—</td>
              <td class="border border-gray-300 px-2 py-2">—</td>
              <td class="border border-gray-300 px-2 py-2 text-left"><strong>Weekly Total</strong></td>
              <td class="border border-gray-300 px-2 py-2 text-center"><strong>{{ weekly_total }}</strong></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="mt-4">
        <a href="{% url 'team_detail' team.id %}" class="inline-block px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 text-sm">
          Manage Team →
        </a>
      </div>
    </div>
  {% else %}
    <div class="container p-2 mx-auto rounded-md sm:p-4 dark:text-gray-800 dark:bg-gray-50">
      <h1 class="text-2xl font-semibold leading-tight mb-4">Welcome to NLL Fantasy</h1>
      {% if user.is_authenticated %}
        <p class="mb-4">You don't have a team yet. Join or create a league to get started!</p>
        <a href="{% url 'league_list' %}" class="inline-block px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 text-sm">
          View Leagues →
        </a>
      {% else %}
        <p class="mb-4">Please log in to view your fantasy team.</p>
        <a href="{% url 'login' %}" class="inline-block px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 text-sm">
          Log In →
        </a>
      {% endif %}
    </div>
  {% endif %}
{% endblock %}